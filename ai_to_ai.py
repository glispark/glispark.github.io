import google.generativeai as genai
import os
import time
from dotenv import load_dotenv

def main():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –¥–∏–∞–ª–æ–≥–∞ –º–µ–∂–¥—É –¥–≤—É–º—è –ò–ò.
    """
    # --- 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ---
    try:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞ (–≤–∫–ª—é—á–∞—è GEMINI_API_KEY)
        load_dotenv()
        
        api_key = os.getenv("GEMINI_API_KEY")
        if not api_key:
            raise ValueError("API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω –∑–∞–¥–∞–Ω –≤ —Ñ–∞–π–ª–µ .env")
            
        genai.configure(api_key=api_key)
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}")
        return

    # --- 2. –°–æ–∑–¥–∞–Ω–∏–µ "–ª–∏—á–Ω–æ—Å—Ç–µ–π" –¥–ª—è –ò–ò ---
    # –ú—ã –º–æ–∂–µ–º –∑–∞–¥–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —á—Ç–æ–±—ã –¥–∏–∞–ª–æ–≥ –±—ã–ª –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ.
    
    # –ò–ò ‚Ññ1: –õ—é–±–æ–ø—ã—Ç–Ω—ã–π —Ñ–∏–ª–æ—Å–æ—Ñ
    philosopher_instruction = "–¢—ã ‚Äî –ª—é–±–æ–ø—ã—Ç–Ω—ã–π —Ñ–∏–ª–æ—Å–æ—Ñ –ø–æ –∏–º–µ–Ω–∏ –ü–ª–∞—Ç–æ–Ω. –¢—ã –∑–∞–¥–∞–µ—à—å –≥–ª—É–±–æ–∫–∏–µ, –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –∏—â–µ—à—å —Å–º—ã—Å–ª –∏ —Ä–∞—Å—Å—É–∂–¥–∞–µ—à—å –æ –ø—Ä–∏—Ä–æ–¥–µ –≤–µ—â–µ–π. –¢–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–º–∏ –∏ –∑–∞—Å—Ç–∞–≤–ª—è—Ç—å –∑–∞–¥—É–º–∞—Ç—å—Å—è."
    
    # –ò–ò ‚Ññ2: –ü—Ä–∞–≥–º–∞—Ç–∏—á–Ω—ã–π —É—á–µ–Ω—ã–π
    scientist_instruction = "–¢—ã ‚Äî –ø—Ä–∞–≥–º–∞—Ç–∏—á–Ω—ã–π —É—á–µ–Ω—ã–π –ø–æ –∏–º–µ–Ω–∏ –ú–∞—Ä–∏—è –ö—é—Ä–∏. –¢—ã –æ—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ–≤, –ª–æ–≥–∏–∫–∏ –∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤. –¢—ã —Ü–µ–Ω–∏—à—å —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É. –¢–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–µ—Ç–∫–∏–º–∏ –∏ –∫–æ—Ä–æ—Ç–∫–∏–º–∏."

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–Ω–µ–º–Ω–æ–≥–æ "—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞", —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)
    generation_config = {
      "temperature": 0.8,
      "top_p": 1,
      "top_k": 1,
      "max_output_tokens": 2048,
    }

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π —Å –∏—Ö "–ª–∏—á–Ω–æ—Å—Ç—è–º–∏"
    ai_philosopher = genai.GenerativeModel(model_name="gemini-1.5-flash",
                                           generation_config=generation_config,
                                           system_instruction=philosopher_instruction)

    ai_scientist = genai.GenerativeModel(model_name="gemini-1.5-flash",
                                          generation_config=generation_config,
                                          system_instruction=scientist_instruction)

    # --- 3. –ó–∞–ø—É—Å–∫ –¥–∏–∞–ª–æ–≥–∞ ---
    print("‚ú® –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –º–µ–∂–¥—É –§–∏–ª–æ—Å–æ—Ñ–æ–º –∏ –£—á–µ–Ω—ã–º... ‚ú®\n")

    # –ù–∞—á–∏–Ω–∞–µ–º —á–∞—Ç-—Å–µ—Å—Å–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
    chat_philosopher = ai_philosopher.start_chat(history=[])
    chat_scientist = ai_scientist.start_chat(history=[])

    # –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–µ—Ä–µ–¥–∞—Å—Ç—Å—è –ø–µ—Ä–≤–æ–º—É –ò–ò
    next_prompt = "–ü—Ä–∏–≤–µ—Ç"
    
    # –û–≥—Ä–∞–Ω–∏—á–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∏ –ª–∏—à–Ω–∏—Ö —Ç—Ä–∞—Ç
    number_of_turns = 8 

    try:
        for i in range(number_of_turns):
            print(f"--- [ –†–∞—É–Ω–¥ {i + 1} ] ---\n")

            # –•–æ–¥ –§–∏–ª–æ—Å–æ—Ñ–∞
            print(f"ü§î –§–∏–ª–æ—Å–æ—Ñ —Ä–∞–∑–º—ã—à–ª—è–µ—Ç –Ω–∞–¥ —Ñ—Ä–∞–∑–æ–π: '{next_prompt}'")
            response_philosopher = chat_philosopher.send_message(next_prompt)
            philosopher_text = response_philosopher.text.strip()
            print(f"ü§î –ü–ª–∞—Ç–æ–Ω: {philosopher_text}\n")
            
            # –û—Ç–≤–µ—Ç –§–∏–ª–æ—Å–æ—Ñ–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º –≤–æ–ø—Ä–æ—Å–æ–º –¥–ª—è –£—á–µ–Ω–æ–≥–æ
            next_prompt = philosopher_text
            time.sleep(2)  # –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏

            # –•–æ–¥ –£—á–µ–Ω–æ–≥–æ
            print(f"üî¨ –£—á–µ–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ—Ä–∞–∑—É: '{next_prompt}'")
            response_scientist = chat_scientist.send_message(next_prompt)
            scientist_text = response_scientist.text.strip()
            print(f"üî¨ –ú–∞—Ä–∏—è –ö—é—Ä–∏: {scientist_text}\n")
            
            # –û—Ç–≤–µ—Ç –£—á–µ–Ω–æ–≥–æ - —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å –¥–ª—è –§–∏–ª–æ—Å–æ—Ñ–∞
            next_prompt = scientist_text
            time.sleep(2)

    except Exception as e:
        print(f"\n–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –¥–∏–∞–ª–æ–≥–∞: {e}")
    finally:
        print("üèÅ –î–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à–µ–Ω. üèÅ")


if __name__ == "__main__":
    main()